
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>SQL优化：执行计划出错之重复索引干扰 | Focus on MySQL,Focus on Life</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="兰春">
    
    <meta name="description" content="本篇为执行计划错误系列第二篇，第一篇地址
背景

MySQL版本

社区版： MySQL 5.6.27 InnoDB

表结构

| test_table | CREATE TABLE test_table ( TagId int(11) NOT NULL AUTO_INCREMENT COMMEN">
    
    
    
    
    
    <link rel="icon" href="/img/lanchun.jpg">
    
    
    <link rel="apple-touch-icon" href="/img/lanchun.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/lanchun.jpg">
    

	
	<link href="http://cdn.bootcss.com/highlight.js/8.2/styles/railscasts.min.css" rel="stylesheet">
	<script src="http://cdn.bootcss.com/highlight.js/8.2/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	

    <link rel="stylesheet" href="/css/style.css" type="text/css">


</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Focus on MySQL,Focus on Life">Focus on MySQL,Focus on Life</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
                    <ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="http://Keithlan.github.io/">Page</a></li>
					
					<li>
					
					</li>
                <li><div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div></li>

				</ul>
			</nav>	
</div>

    </header>
    <div id="container" class="clearfix">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/14/wrong_index/" title="SQL优化：执行计划出错之重复索引干扰" itemprop="url">SQL优化：执行计划出错之重复索引干扰</a>
  </h1>
  <p class="article-author">By
    
      <a href="https://Keithlan.github.io" title="兰春">兰春</a>
    </p>
  <p class="article-time">
    <time datetime="2016-03-14T03:32:24.000Z" itemprop="datePublished">Mar 14 2016</time>
    Updated:<time datetime="2016-03-14T08:39:50.000Z" itemprop="dateModified">Mar 14 2016</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#本篇为执行计划错误系列第二篇，第一篇地址"><span class="toc-number">1.</span> <span class="toc-text">本篇为执行计划错误系列第二篇，第一篇地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#背景"><span class="toc-number">2.</span> <span class="toc-text">背景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL版本"><span class="toc-number">2.1.</span> <span class="toc-text">MySQL版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表结构"><span class="toc-number">2.2.</span> <span class="toc-text">表结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#index_选择性"><span class="toc-number">2.3.</span> <span class="toc-text">index 选择性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题SQL"><span class="toc-number">2.4.</span> <span class="toc-text">问题SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题再哪里？"><span class="toc-number">2.5.</span> <span class="toc-text">问题再哪里？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#继续分析"><span class="toc-number">2.6.</span> <span class="toc-text">继续分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#最后的优化建议："><span class="toc-number">2.7.</span> <span class="toc-text">最后的优化建议：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#疑问"><span class="toc-number">2.8.</span> <span class="toc-text">疑问</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最后总结"><span class="toc-number">3.</span> <span class="toc-text">最后总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#详细的执行代价评估"><span class="toc-number">4.</span> <span class="toc-text">详细的执行代价评估</span></a></li></ol>
		</div>
		
		<h2 id="本篇为执行计划错误系列第二篇，第一篇地址">本篇为执行计划错误系列第二篇，<a href="http://keithlan.github.io/2015/07/14/mysql_group_order_limit/" target="_blank" rel="external">第一篇地址</a></h2>
<h2 id="背景">背景</h2>
<hr>
<h3 id="MySQL版本">MySQL版本</h3>
<blockquote>
<p>社区版： MySQL 5.6.27 InnoDB</p>
</blockquote>
<h3 id="表结构">表结构</h3>
<blockquote>
<p>| test_table | CREATE TABLE <code>test_table</code> (<br> <code>TagId</code> int(11) NOT NULL AUTO_INCREMENT COMMENT ‘’,<br> <code>TagType</code> int(11) DEFAULT NULL COMMENT ‘’,<br> <code>SubType</code> int(11) DEFAULT NULL COMMENT ‘’,<br> <code>CommId</code> int(11) NOT NULL DEFAULT ‘0’ COMMENT ‘’,<br> <code>TagFlag</code> int(11) NOT NULL DEFAULT ‘0’ COMMENT ‘’,<br> <code>TagName</code> varchar(255) DEFAULT NULL COMMENT ‘’,<br> <code>OrderId</code> int(11) DEFAULT ‘0’ COMMENT ‘’,<br> <code>Unum</code> int(10) NOT NULL DEFAULT ‘0’ COMMENT ‘’,<br> <code>IsBest</code> int(11) NOT NULL DEFAULT ‘0’ COMMENT ‘’,<br> <code>BrokerId</code> int(11) NOT NULL DEFAULT ‘0’ COMMENT ‘’,<br> <code>AddDate</code> int(11) DEFAULT NULL COMMENT ‘’,<br> <code>UpdateDate</code> int(11) DEFAULT NULL COMMENT ‘’,<br> <code>updatetime</code> timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,<br> <code>tmpnum</code> int(10) DEFAULT ‘0’ COMMENT ‘’,<br> <code>cityid</code> int(11) DEFAULT ‘0’ COMMENT ‘’,<br> PRIMARY KEY (<code>TagId</code>),<br> KEY <code>idx_4</code> (<code>IsBest</code>,<code>TagFlag</code>,<code>CommId</code>),<br> KEY <code>idx_1</code> (<code>TagType</code>,<code>TagName</code>,<code>CommId</code>),<br> KEY <code>idxnew</code> (<code>UpdateDate</code>),<br> KEY <code>idx_lc</code> (<code>TagType</code>,<code>TagName</code>,<code>TagId</code>)<br> KEY <code>idx_lc_2</code> (<code>TagName</code>,<code>TagType</code>,<code>TagId</code>),<br>) ENGINE=InnoDB AUTO_INCREMENT=19387169 DEFAULT CHARSET=utf8 |  </p>
</blockquote>
<h3 id="index_选择性">index 选择性</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">+-----------------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</div><div class="line">| <span class="class">Table</span>           | <span class="class">Non_unique</span> | <span class="class">Key_name</span>   | <span class="class">Seq_in_index</span> | <span class="class">Column_name</span> | <span class="class">Collation</span> | <span class="class">Cardinality</span> | <span class="class">Sub_part</span> | <span class="class">Packed</span> | <span class="class">Null</span> | <span class="class">Index_type</span> | <span class="class">Comment</span> | <span class="class">Index_comment</span> |</div><div class="line">+-----------------+------------+------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">0</span> | <span class="class">PRIMARY</span>    |            <span class="number">1</span> | <span class="class">TagId</span>       | <span class="class">A</span>         |     <span class="number">1128048</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   |      | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_4      |</span>            <span class="number">1</span> | <span class="class">IsBest</span>      | <span class="class">A</span>         |           <span class="number">2</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   |      | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_4      |</span>            <span class="number">2</span> | <span class="class">TagFlag</span>     | <span class="class">A</span>         |           <span class="number">4</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   |      | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_4      |</span>            <span class="number">3</span> | <span class="class">CommId</span>      | <span class="class">A</span>         |       <span class="number">56402</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   |      | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_1      |</span>            <span class="number">1</span> | <span class="class">TagType</span>     | <span class="class">A</span>         |           <span class="number">2</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   | <span class="class">YES</span>  | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_1      |</span>            <span class="number">2</span> | <span class="class">TagName</span>     | <span class="class">A</span>         |     <span class="number">1128048</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   | <span class="class">YES</span>  | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_1      |</span>            <span class="number">3</span> | <span class="class">TagId</span>       | <span class="class">A</span>         |     <span class="number">1128048</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   |      | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idxnew     |</span>            <span class="number">1</span> | <span class="class">UpdateDate</span>  | <span class="class">A</span>         |     <span class="number">1128048</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   | <span class="class">YES</span>  | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_lc     |</span>            <span class="number">1</span> | <span class="class">TagType</span>     | <span class="class">A</span>         |           <span class="number">2</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   | <span class="class">YES</span>  | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_lc     |</span>            <span class="number">2</span> | <span class="class">TagName</span>     | <span class="class">A</span>         |     <span class="number">1128048</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   | <span class="class">YES</span>  | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_lc     |</span>            <span class="number">3</span> | <span class="class">TagId</span>       | <span class="class">A</span>         |     <span class="number">1128048</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   |      | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_lc_2   |</span>            <span class="number">1</span> | <span class="class">TagName</span>     | <span class="class">A</span>         |     <span class="number">1128048</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   | <span class="class">YES</span>  | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_lc_2   |</span>            <span class="number">2</span> | <span class="class">TagType</span>     | <span class="class">A</span>         |     <span class="number">1128048</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   | <span class="class">YES</span>  | <span class="class">BTREE</span>      |         |               |</div><div class="line"><span class="localvars">| test_table      |</span>          <span class="number">1</span> <span class="localvars">| idx_lc_2   |</span>            <span class="number">3</span> | <span class="class">TagId</span>       | <span class="class">A</span>         |     <span class="number">1128048</span> |     <span class="class">NULL</span> | <span class="class">NULL</span>   |      | <span class="class">BTREE</span>      |         |               |</div><div class="line">+-----------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+-----------------+</div></pre></td></tr></table></figure>

<h3 id="问题SQL">问题SQL</h3>
<blockquote>
<p>select * from test_db.test_table  where <code>TagType</code> = ‘1’  and <code>TagName</code> = ‘采光充足’       order by TagId limit   1;  </p>
</blockquote>
<h3 id="问题再哪里？">问题再哪里？</h3>
<ul>
<li><strong>执行计划</strong></li>
</ul>
<blockquote>
<p>root:test_db&gt;  explain select * from test_db.test_table  where <code>TagType</code> = 1  and <code>TagName</code> = ‘采光充足’       order by TagId limit   1;<br>+——+——————-+————————-+———-+———————-+————-+————-+———+———+——————-+<br>| id | select_type | table           | type  | possible_keys | key     | key_len | ref  | rows | Extra       |<br>+——+——————-+————————-+———-+———————-+————-+————-+———+———+——————-+<br>|  1 | SIMPLE      | test_table | index | idx_1,idx_lc,idx_lc_2  | PRIMARY | 4       | NULL |  386 | Using where |<br>+——+——————-+————————-+———-+———————-+————-+————-+———+———+——————-+<br>1 row in set (0.00 sec)</p>
<p> Time: 160313  0:07:16<br> User@Host: [] @  []  Id: 7123914939<br> Query_time: 0.246356  Lock_time: 0.000036 Rows_sent: 1  Rows_examined: 470135<br> SET timestamp=1457798836;<br> select <code>TagId</code>,<code>TagType</code>,<code>SubType</code>,<code>CommId</code>,<code>TagFlag</code>,<code>TagName</code>,<code>OrderId</code>,<code>Unum</code>,<code>IsBest</code>,<code>BrokerId</code>,<code>AddDate</code>,<code>UpdateDate</code>,<code>updatetime</code>,<code>tmpnum</code>,<code>cityid</code> from <code>test_table</code> where <code>TagType</code> = 1  and <code>TagName</code> = ‘采光充足’  order by <code>TagId</code> ASC limit 1 ;</p>
</blockquote>
<ul>
<li><strong>痛点分析</strong></li>
</ul>
<blockquote>
<p>1）primary ， type=index，表示全索引扫描。  </p>
<p>2) 按照索引原理，这样的SQL语句应该使用的正确的索引是：idx_lc， type=ref。  </p>
</blockquote>
<p>root:test_db&gt;  explain select * from test_db.test_table force index(idx_lc) where <code>TagType</code> = 1  and <code>TagName</code> = ‘采光充足’       order by TagId limit   1;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">+----+-------------+-----------------+------+---------------+--------+---------+-------------+------+------------------------------------+</div><div class="line">| id | select_type | table           | <span class="keyword">type</span> | possible_keys | key    | key_len | <span class="keyword">ref</span>         | rows | <span class="type">Extra</span>                              |</div><div class="line">+----+-------------+-----------------+------+---------------+--------+---------+-------------+------+------------------------------------+</div><div class="line">|  <span class="number">1</span> | <span class="type">SIMPLE</span>      | test_table | <span class="keyword">ref</span>  | idx_lc        | idx_lc | <span class="number">773</span>     | <span class="keyword">const</span>,<span class="keyword">const</span> | <span class="number">2930</span> | <span class="type">Using</span> index condition; <span class="type">Using</span> where |</div><div class="line">+----+-------------+-----------------+------+---------------+--------+---------+-------------+------+------------------------------------+</div><div class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="type">set</span> (<span class="number">0</span>.<span class="number">00</span> sec)</div></pre></td></tr></table></figure>

<blockquote>
<p>3）到这里，肯定大部分人问，既然force index可以解决问题，为啥不让开发修改SQL为force index呢?</p>
</blockquote>
<pre><code>a) 能不让开发修改，就不让开发修改，这样成本最低。

b）况且，这根本就不是SQL语句本身的问题，为什么要修改SQL呢？

c）如果以后不小心删掉了这个索引，那么<span class="literal">force</span> index的语句就会报错，会导致业务中断。
</code></pre><p>以上种种原因，force index 始终不是最终的积极方案。</p>
<p>那么问题来了</p>
<p>使用idx_lc代价最小，速度最快。  为什么MySQL不用呢？</p>
<h3 id="继续分析">继续分析</h3>
<ul>
<li>如果观察仔细的小伙伴们会发现，以上的索引有很多是重复的<blockquote>
<p> PRIMARY KEY (<code>TagId</code>),<br>KEY <code>idx_4</code> (<code>IsBest</code>,<code>TagFlag</code>,<code>CommId</code>),<br>KEY <code>idx_1</code> (<code>TagType</code>,<code>TagName</code>,<code>CommId</code>),<br>KEY <code>idxnew</code> (<code>UpdateDate</code>),<br>KEY <code>idx_lc</code> (<code>TagType</code>,<code>TagName</code>,<code>TagId</code>)<br>KEY <code>idx_lc_2</code> (<code>TagName</code>,<code>TagType</code>,<code>TagId</code>),  </p>
</blockquote>
</li>
</ul>
<ul>
<li>possibles key 的选择问题</li>
</ul>
<blockquote>
<p>为什么在 idx_1,idx_lc,idx_lc_2 中 却选择的 primary key 呢？   </p>
</blockquote>
<ul>
<li>我试着删掉一个索引试试看</li>
</ul>
<blockquote>
<p>root:test_db&gt; alter table test_table drop index idx_1;<br>Query OK, 0 rows affected (0.01 sec)<br>Records: 0  Duplicates: 0  Warnings: 0<br>root:test_db&gt;  explain select * from test_db.test_table force index(idx_lc) where <code>TagType</code> = 1  and <code>TagName</code> = ‘采光充足’       order by TagId limit   1;<br>+——+——————-+————————-+———+———————-+————+————-+——————-+———+——————————————————+<br>| id | select_type | table           | type | possible_keys | key    | key_len | ref         | rows | Extra                              |<br>+——+——————-+————————-+———+———————-+————+————-+——————-+———+——————————————————+<br>|  1 | SIMPLE      | test_table | ref  | idx_lc,idx_lc_2        | idx_lc | 773     | const,const | 2930 | Using index condition; Using where |<br>+——+——————-+————————-+———+———————-+————+————-+——————-+———+——————————————————+<br>1 row in set (0.00 sec)  </p>
</blockquote>
<p>这样，执行语句奇迹般的好了。让我开始对index 的顺序问题产生怀疑</p>
<ul>
<li><p>ok，我在重建idx_1索引</p>
<p>PRIMARY KEY (<code>TagId</code>),<br>KEY <code>idx_4</code> (<code>IsBest</code>,<code>TagFlag</code>,<code>CommId</code>),<br>KEY <code>idxnew</code> (<code>UpdateDate</code>),<br>KEY <code>idx_lc</code> (<code>TagType</code>,<code>TagName</code>,<code>TagId</code>)<br>KEY <code>idx_lc_2</code> (<code>TagName</code>,<code>TagType</code>,<code>TagId</code>),<br>KEY <code>idx_1</code> (<code>TagType</code>,<code>TagName</code>,<code>CommId</code>),  </p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">root:test_db&gt;  explain select * <span class="keyword">from</span> test_db.test_table force index(idx_lc) where `<span class="type">TagType</span>` = <span class="number">1</span>  <span class="keyword">and</span> `<span class="type">TagName</span>` = '采光充足'       order by <span class="type">TagId</span> limit   <span class="number">1</span>;  </div><div class="line">+----+-------------+-----------------+------+---------------+--------+---------+-------------+------+------------------------------------+  </div><div class="line">| id | select_type | table           | <span class="keyword">type</span> | possible_keys | key    | key_len |   <span class="keyword">ref</span>         | rows | <span class="type">Extra</span>                              |</div><div class="line">+----+-------------+-----------------+------+---------------+--------+---------+-------------+------+------------------------------------+  </div><div class="line">|  <span class="number">1</span> | <span class="type">SIMPLE</span>      | test_table | <span class="keyword">ref</span>  | idx_lc,idx_lc_2,idx_1        | idx_lc | <span class="number">773</span>     | <span class="keyword">const</span>,<span class="keyword">const</span> | <span class="number">2930</span> | <span class="type">Using</span> index condition; <span class="type">Using</span> where |  </div><div class="line">+----+-------------+-----------------+------+---------------+--------+---------+-------------+------+------------------------------------+  </div><div class="line"><span class="number">1</span> row <span class="keyword">in</span> <span class="type">set</span> (<span class="number">0</span>.<span class="number">00</span> sec)</div></pre></td></tr></table></figure>

<ul>
<li>我再将idx_lc 删掉后再重建呢？  <blockquote>
<p> PRIMARY KEY (<code>TagId</code>),<br>KEY <code>idx_4</code> (<code>IsBest</code>,<code>TagFlag</code>,<code>CommId</code>),<br>KEY <code>idxnew</code> (<code>UpdateDate</code>),<br>KEY <code>idx_lc_2</code> (<code>TagType</code>,<code>TagName</code>,<code>TagId</code>)<br>KEY <code>idx_1</code> (<code>TagType</code>,<code>TagName</code>,<code>CommId</code>),<br>KEY <code>idx_lc</code> (<code>TagType</code>,<code>TagName</code>,<code>TagId</code>)  </p>
</blockquote>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="header">root:test_db&gt;  explain select * from test_db.test_table force index(idx_lc) where `TagType` = 1  and `TagName` = '采光充足'       order by TagId limit   1;</span></div><div class="line">+----+-------------+-----------------+------+---------------+--------+---------+-------------+------+------------------------------------+</div><div class="line"><span class="header">| id | select_type | table           | type | possible_keys | key    | key_len | ref         | rows | Extra                              |</span></div><div class="line">+----+-------------+-----------------+------+---------------+--------+---------+-------------+------+------------------------------------+</div><div class="line"><span class="header">|  1 | SIMPLE      | test_table | ref  | idx_lc_2,idx_1,idx_lc        | idx_lc | 773     | const,const | 2930 | Using index condition; Using where |</span></div><div class="line">+----+-------------+-----------------+------+---------------+--------+---------+-------------+------+------------------------------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure>

<h3 id="最后的优化建议：">最后的优化建议：</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">删除掉 idx_1 干扰索引。</div></pre></td></tr></table></figure>

<h3 id="疑问">疑问</h3>
<p>MySQL不至于这么傻吧？应该不是根据RBO哇，说好的CBO呢？</p>
<p>所以，我又在test库中创新创建了一张表，表结构和原来一样，数据完全导入到过来</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">use</span> test;</span></div><div class="line"></div><div class="line"><span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> lc_test <span class="keyword">like</span> xx_db.test_table;</span></div><div class="line"></div><div class="line"><span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> lc_test <span class="keyword">select</span> * <span class="keyword">from</span> xx_db.test_table;</span></div><div class="line">Query OK, 1137914 rows affected (25.30 sec)</div><div class="line">Records: 1137914  Duplicates: 0  Warnings: 0</div><div class="line"></div><div class="line">| lc_test | <span class="operator"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`lc_test`</span> (</span></div><div class="line">  <span class="string">`TagId`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`TagType`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`SubType`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`CommId`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`TagFlag`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`TagName`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`OrderId`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`Unum`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`IsBest`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">'0'</span>,</div><div class="line">  <span class="string">`BrokerId`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`AddDate`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`UpdateDate`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`updatetime`</span> <span class="keyword">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</div><div class="line">  <span class="string">`tmpnum`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="string">`cityid`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">''</span>,</div><div class="line">  <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (<span class="string">`TagId`</span>),</div><div class="line">  <span class="keyword">KEY</span> <span class="string">`idx_4`</span> (<span class="string">`IsBest`</span>,<span class="string">`TagFlag`</span>,<span class="string">`CommId`</span>),</div><div class="line">  <span class="keyword">KEY</span> <span class="string">`idx_1`</span> (<span class="string">`TagType`</span>,<span class="string">`TagName`</span>,<span class="string">`CommId`</span>),</div><div class="line">  <span class="keyword">KEY</span> <span class="string">`idxnew`</span> (<span class="string">`UpdateDate`</span>),</div><div class="line">  <span class="keyword">KEY</span> <span class="string">`idx_lc`</span> (<span class="string">`TagType`</span>,<span class="string">`TagName`</span>,<span class="string">`TagId`</span>),</div><div class="line">  <span class="keyword">KEY</span> <span class="string">`idx_lc_2`</span> (<span class="string">`TagName`</span>,<span class="string">`TagType`</span>,<span class="string">`TagId`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">19387105</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</div><div class="line"></div><div class="line"></div><div class="line">root:test&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> lc_test  <span class="keyword">where</span> <span class="string">`TagType`</span> = <span class="number">1</span>  <span class="keyword">and</span> <span class="string">`TagName`</span> = <span class="string">'采光充足'</span>       <span class="keyword">order</span> <span class="keyword">by</span> TagId <span class="keyword">limit</span>   <span class="number">1</span>;</div><div class="line">+<span class="comment">----+-------------+---------+------+-----------------------+--------+---------+-------------+------+------------------------------------+</span></div><div class="line">| id | select_type | table   | type | possible_keys         | key    | key_len | ref         | rows | Extra                              |</div><div class="line">+<span class="comment">----+-------------+---------+------+-----------------------+--------+---------+-------------+------+------------------------------------+</span></div><div class="line">|  1 | SIMPLE      | lc_test | ref  | idx_1,idx_lc,idx_lc_2 | idx_lc | 773     | const,const | 2928 | Using index condition; Using where |</div><div class="line">+<span class="comment">----+-------------+---------+------+-----------------------+--------+---------+-------------+------+------------------------------------+</span></div><div class="line">1 row in <span class="operator"><span class="keyword">set</span> (<span class="number">0.00</span> sec)</span></div><div class="line"></div><div class="line">这里，虽然顺序是  idx_1,idx_lc,idx_lc_2， 但是它选择了 idx_lc 正确的索引。</div><div class="line"></div><div class="line">这又说明，并不是我们想象的按照索引顺序选择。</div></pre></td></tr></table></figure>

<h2 id="最后总结">最后总结</h2>
<ol>
<li>从上述测试来看，MySQL执行计划应该是 CBO + CRO的结合体 ？ 待确认</li>
<li>一般情况下，MySQL可以很好的选择执行计划，但是收到重复索引，数据分布等的干扰后，可能不准确</li>
<li>我们能做的就是<ul>
<li>等待官方优化器的改进</li>
<li>尽量避开干扰项，如：主动删除重复性索引等</li>
</ul>
</li>
</ol>
<h2 id="详细的执行代价评估">详细的执行代价评估</h2>
<ul>
<li><strong>错误的选择</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div></pre></td><td class="code"><pre><div class="line">{\</div><div class="line">  "steps": [\</div><div class="line">    {\</div><div class="line">      "join_preparation": {\</div><div class="line">        "<span class="operator"><span class="keyword">select</span>#<span class="string">": 1,\</span></span></div><div class="line">        "steps<span class="string">": [\</span></div><div class="line">          {\</div><div class="line">            "expanded_query<span class="string">": "</span><span class="comment">/* select#1 */</span> <span class="keyword">select</span> <span class="string">`test_table`</span>.<span class="string">`TagId`</span> <span class="keyword">AS</span> <span class="string">`TagId`</span>,<span class="string">`test_table`</span>.<span class="string">`TagType`</span> <span class="keyword">AS</span> <span class="string">`TagType`</span>,<span class="string">`test_table`</span>.<span class="string">`SubType`</span> <span class="keyword">AS</span> <span class="string">`SubType`</span>,<span class="string">`test_table`</span>.<span class="string">`CommId`</span> <span class="keyword">AS</span> <span class="string">`CommId`</span>,<span class="string">`test_table`</span>.<span class="string">`TagFlag`</span> <span class="keyword">AS</span> <span class="string">`TagFlag`</span>,<span class="string">`test_table`</span>.<span class="string">`TagName`</span> <span class="keyword">AS</span> <span class="string">`TagName`</span>,<span class="string">`test_table`</span>.<span class="string">`OrderId`</span> <span class="keyword">AS</span> <span class="string">`OrderId`</span>,<span class="string">`test_table`</span>.<span class="string">`Unum`</span> <span class="keyword">AS</span> <span class="string">`Unum`</span>,<span class="string">`test_table`</span>.<span class="string">`IsBest`</span> <span class="keyword">AS</span> <span class="string">`IsBest`</span>,<span class="string">`test_table`</span>.<span class="string">`BrokerId`</span> <span class="keyword">AS</span> <span class="string">`BrokerId`</span>,<span class="string">`test_table`</span>.<span class="string">`AddDate`</span> <span class="keyword">AS</span> <span class="string">`AddDate`</span>,<span class="string">`test_table`</span>.<span class="string">`UpdateDate`</span> <span class="keyword">AS</span> <span class="string">`UpdateDate`</span>,<span class="string">`test_table`</span>.<span class="string">`updatetime`</span> <span class="keyword">AS</span> <span class="string">`updatetime`</span>,<span class="string">`test_table`</span>.<span class="string">`tmpnum`</span> <span class="keyword">AS</span> <span class="string">`tmpnum`</span>,<span class="string">`test_table`</span>.<span class="string">`cityid`</span> <span class="keyword">AS</span> <span class="string">`cityid`</span> <span class="keyword">from</span> <span class="string">`test_table`</span> <span class="keyword">where</span> ((<span class="string">`test_table`</span>.<span class="string">`TagType`</span> = <span class="number">1</span>) <span class="keyword">and</span> (<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>)) <span class="keyword">order</span> <span class="keyword">by</span> <span class="string">`test_table`</span>.<span class="string">`TagId`</span> <span class="keyword">limit</span> <span class="number">1</span><span class="string">"\</span></div><div class="line">          }\</div><div class="line">        ]\</div><div class="line">      }\</div><div class="line">    },\</div><div class="line">    {\</div><div class="line">      "join_optimization<span class="string">": {\</span></div><div class="line">        "<span class="keyword">select</span>#<span class="string">": 1,\</span></div><div class="line">        "steps<span class="string">": [\</span></div><div class="line">          {\</div><div class="line">            "condition_processing<span class="string">": {\</span></div><div class="line">              "condition<span class="string">": "</span><span class="keyword">WHERE</span><span class="string">",\</span></div><div class="line">              "original_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagType`</span> = <span class="number">1</span>) <span class="keyword">and</span> (<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>))<span class="string">",\</span></div><div class="line">              "steps<span class="string">": [\</span></div><div class="line">                {\</div><div class="line">                  "transformation<span class="string">": "</span>equality_propagation<span class="string">",\</span></div><div class="line">                  "resulting_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>) <span class="keyword">and</span> multiple equal(<span class="number">1</span>, <span class="string">`test_table`</span>.<span class="string">`TagType`</span>))<span class="string">"\</span></div><div class="line">                },\</div><div class="line">                {\</div><div class="line">                  "transformation<span class="string">": "</span>constant_propagation<span class="string">",\</span></div><div class="line">                  "resulting_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>) <span class="keyword">and</span> multiple equal(<span class="number">1</span>, <span class="string">`test_table`</span>.<span class="string">`TagType`</span>))<span class="string">"\</span></div><div class="line">                },\</div><div class="line">                {\</div><div class="line">                  "transformation<span class="string">": "</span>trivial_condition_removal<span class="string">",\</span></div><div class="line">                  "resulting_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>) <span class="keyword">and</span> multiple equal(<span class="number">1</span>, <span class="string">`test_table`</span>.<span class="string">`TagType`</span>))<span class="string">"\</span></div><div class="line">                }\</div><div class="line">              ]\</div><div class="line">            }\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "table_dependencies<span class="string">": [\</span></div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "row_may_be_null<span class="string">": false,\</span></div><div class="line">                "map_bit<span class="string">": 0,\</span></div><div class="line">                "depends_on_map_bits<span class="string">": [\</span></div><div class="line">                ]\</div><div class="line">              }\</div><div class="line">            ]\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "ref_optimizer_key_uses<span class="string">": [\</span></div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "<span class="keyword">field</span><span class="string">": "</span>TagType<span class="string">",\</span></div><div class="line">                "equals<span class="string">": "</span><span class="number">1</span><span class="string">",\</span></div><div class="line">                "null_rejecting<span class="string">": false\</span></div><div class="line">              },\</div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "<span class="keyword">field</span><span class="string">": "</span>TagName<span class="string">",\</span></div><div class="line">                "equals<span class="string">": "</span><span class="string">'采光充足'</span><span class="string">",\</span></div><div class="line">                "null_rejecting<span class="string">": false\</span></div><div class="line">              },\</div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "<span class="keyword">field</span><span class="string">": "</span>TagType<span class="string">",\</span></div><div class="line">                "equals<span class="string">": "</span><span class="number">1</span><span class="string">",\</span></div><div class="line">                "null_rejecting<span class="string">": false\</span></div><div class="line">              },\</div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "<span class="keyword">field</span><span class="string">": "</span>TagName<span class="string">",\</span></div><div class="line">                "equals<span class="string">": "</span><span class="string">'采光充足'</span><span class="string">",\</span></div><div class="line">                "null_rejecting<span class="string">": false\</span></div><div class="line">              },\</div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "<span class="keyword">field</span><span class="string">": "</span>TagName<span class="string">",\</span></div><div class="line">                "equals<span class="string">": "</span><span class="string">'采光充足'</span><span class="string">",\</span></div><div class="line">                "null_rejecting<span class="string">": false\</span></div><div class="line">              },\</div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "<span class="keyword">field</span><span class="string">": "</span>TagType<span class="string">",\</span></div><div class="line">                "equals<span class="string">": "</span><span class="number">1</span><span class="string">",\</span></div><div class="line">                "null_rejecting<span class="string">": false\</span></div><div class="line">              }\</div><div class="line">            ]\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "rows_estimation<span class="string">": [\</span></div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "range_analysis<span class="string">": {\</span></div><div class="line">                  "table_scan<span class="string">": {\</span></div><div class="line">                    "<span class="keyword">rows</span><span class="string">": 1132201,\</span></div><div class="line">                    "cost<span class="string">": 233202\</span></div><div class="line">                  },\</div><div class="line">                  "potential_range_indices<span class="string">": [\</span></div><div class="line">                    {\</div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span><span class="keyword">PRIMARY</span><span class="string">",\</span></div><div class="line">                      "usable<span class="string">": false,\</span></div><div class="line">                      "cause<span class="string">": "</span>not_applicable<span class="string">"\</span></div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_4<span class="string">",\</span></div><div class="line">                      "usable<span class="string">": false,\</span></div><div class="line">                      "cause<span class="string">": "</span>not_applicable<span class="string">"\</span></div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_1<span class="string">",\</span></div><div class="line">                      "usable<span class="string">": true,\</span></div><div class="line">                      "key_parts<span class="string">": [\</span></div><div class="line">                        "TagType<span class="string">",\</span></div><div class="line">                        "TagName<span class="string">",\</span></div><div class="line">                        "CommId<span class="string">",\</span></div><div class="line">                        "TagId<span class="string">"\</span></div><div class="line">                      ]\</div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idxnew<span class="string">",\</span></div><div class="line">                      "usable<span class="string">": false,\</span></div><div class="line">                      "cause<span class="string">": "</span>not_applicable<span class="string">"\</span></div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_lc<span class="string">",\</span></div><div class="line">                      "usable<span class="string">": true,\</span></div><div class="line">                      "key_parts<span class="string">": [\</span></div><div class="line">                        "TagType<span class="string">",\</span></div><div class="line">                        "TagName<span class="string">",\</span></div><div class="line">                        "TagId<span class="string">"\</span></div><div class="line">                      ]\</div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_lc_2<span class="string">",\</span></div><div class="line">                      "usable<span class="string">": true,\</span></div><div class="line">                      "key_parts<span class="string">": [\</span></div><div class="line">                        "TagName<span class="string">",\</span></div><div class="line">                        "TagType<span class="string">",\</span></div><div class="line">                        "TagId<span class="string">"\</span></div><div class="line">                      ]\</div><div class="line">                    }\</div><div class="line">                  ],\</div><div class="line">                  "setup_range_conditions<span class="string">": [\</span></div><div class="line">                  ],\</div><div class="line">                  "group_index_range<span class="string">": {\</span></div><div class="line">                    "chosen<span class="string">": false,\</span></div><div class="line">                    "cause<span class="string">": "</span>not_group_by_or_distinct<span class="string">"\</span></div><div class="line">                  },\</div><div class="line">                  "analyzing_range_alternatives<span class="string">": {\</span></div><div class="line">                    "range_scan_alternatives<span class="string">": [\</span></div><div class="line">                      {\</div><div class="line">                        "<span class="keyword">index</span><span class="string">": "</span>idx_1<span class="string">",\</span></div><div class="line">                        "ranges<span class="string">": [\</span></div><div class="line">                          "<span class="number">1</span> &lt;= TagType &lt;= <span class="number">1</span> <span class="keyword">AND</span> 采光充足 &lt;= TagName &lt;= 采光充足<span class="string">"\</span></div><div class="line">                        ],\</div><div class="line">                        "index_dives_for_eq_ranges<span class="string">": true,\</span></div><div class="line">                        "rowid_ordered<span class="string">": false,\</span></div><div class="line">                        "using_mrr<span class="string">": false,\</span></div><div class="line">                        "index_only<span class="string">": false,\</span></div><div class="line">                        "<span class="keyword">rows</span><span class="string">": 2924,\</span></div><div class="line">                        "cost<span class="string">": 3509.8,\</span></div><div class="line">                        "chosen<span class="string">": true\</span></div><div class="line">                      },\</div><div class="line">                      {\</div><div class="line">                        "<span class="keyword">index</span><span class="string">": "</span>idx_lc<span class="string">",\</span></div><div class="line">                        "ranges<span class="string">": [\</span></div><div class="line">                          "<span class="number">1</span> &lt;= TagType &lt;= <span class="number">1</span> <span class="keyword">AND</span> 采光充足 &lt;= TagName &lt;= 采光充足<span class="string">"\</span></div><div class="line">                        ],\</div><div class="line">                        "index_dives_for_eq_ranges<span class="string">": true,\</span></div><div class="line">                        "rowid_ordered<span class="string">": true,\</span></div><div class="line">                        "using_mrr<span class="string">": false,\</span></div><div class="line">                        "index_only<span class="string">": false,\</span></div><div class="line">                        "<span class="keyword">rows</span><span class="string">": 2924,\</span></div><div class="line">                        "cost<span class="string">": 3509.8,\</span></div><div class="line">                        "chosen<span class="string">": false,\</span></div><div class="line">                        "cause<span class="string">": "</span>cost<span class="string">"\</span></div><div class="line">                      },\</div><div class="line">                      {\</div><div class="line">                        "<span class="keyword">index</span><span class="string">": "</span>idx_lc_2<span class="string">",\</span></div><div class="line">                        "ranges<span class="string">": [\</span></div><div class="line">                          "采光充足 &lt;= TagName &lt;= 采光充足 <span class="keyword">AND</span> <span class="number">1</span> &lt;= TagType &lt;= <span class="number">1</span><span class="string">"\</span></div><div class="line">                        ],\</div><div class="line">                        "index_dives_for_eq_ranges<span class="string">": true,\</span></div><div class="line">                        "rowid_ordered<span class="string">": true,\</span></div><div class="line">                        "using_mrr<span class="string">": false,\</span></div><div class="line">                        "index_only<span class="string">": false,\</span></div><div class="line">                        "<span class="keyword">rows</span><span class="string">": 2924,\</span></div><div class="line">                        "cost<span class="string">": 3509.8,\</span></div><div class="line">                        "chosen<span class="string">": false,\</span></div><div class="line">                        "cause<span class="string">": "</span>cost<span class="string">"\</span></div><div class="line">                      }\</div><div class="line">                    ],\</div><div class="line">                    "analyzing_roworder_intersect<span class="string">": {\</span></div><div class="line">                      "intersecting_indices<span class="string">": [\</span></div><div class="line">                        {\</div><div class="line">                          "<span class="keyword">index</span><span class="string">": "</span>idx_lc<span class="string">",\</span></div><div class="line">                          "index_scan_cost<span class="string">": 266.73,\</span></div><div class="line">                          "cumulated_index_scan_cost<span class="string">": 266.73,\</span></div><div class="line">                          "disk_sweep_cost<span class="string">": 2771.5,\</span></div><div class="line">                          "cumulated_total_cost<span class="string">": 3038.2,\</span></div><div class="line">                          "usable<span class="string">": true,\</span></div><div class="line">                          "matching_rows_now<span class="string">": 2924,\</span></div><div class="line">                          "isect_covering_with_this_index<span class="string">": false,\</span></div><div class="line">                          "chosen<span class="string">": true\</span></div><div class="line">                        },\</div><div class="line">                        {\</div><div class="line">                          "<span class="keyword">index</span><span class="string">": "</span>idx_lc_2<span class="string">",\</span></div><div class="line">                          "cumulated_total_cost<span class="string">": 3038.2,\</span></div><div class="line">                          "usable<span class="string">": false,\</span></div><div class="line">                          "cause<span class="string">": "</span>does_not_reduce_cost_of_intersect<span class="string">"\</span></div><div class="line">                        }\</div><div class="line">                      ],\</div><div class="line">                      "clustered_pk<span class="string">": {\</span></div><div class="line">                        "clustered_pk_added_to_intersect<span class="string">": false,\</span></div><div class="line">                        "cause<span class="string">": "</span>no_clustered_pk_index<span class="string">"\</span></div><div class="line">                      },\</div><div class="line">                      "chosen<span class="string">": false,\</span></div><div class="line">                      "cause<span class="string">": "</span>too_few_indexes_to_merge<span class="string">"\</span></div><div class="line">                    }\</div><div class="line">                  },\</div><div class="line">                  "chosen_range_access_summary<span class="string">": {\</span></div><div class="line">                    "range_access_plan<span class="string">": {\</span></div><div class="line">                      "type<span class="string">": "</span>range_scan<span class="string">",\</span></div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_1<span class="string">",\</span></div><div class="line">                      "<span class="keyword">rows</span><span class="string">": 2924,\</span></div><div class="line">                      "ranges<span class="string">": [\</span></div><div class="line">                        "<span class="number">1</span> &lt;= TagType &lt;= <span class="number">1</span> <span class="keyword">AND</span> 采光充足 &lt;= TagName &lt;= 采光充足<span class="string">"\</span></div><div class="line">                      ]\</div><div class="line">                    },\</div><div class="line">                    "rows_for_plan<span class="string">": 2924,\</span></div><div class="line">                    "cost_for_plan<span class="string">": 3509.8,\</span></div><div class="line">                    "chosen<span class="string">": true\</span></div><div class="line">                  }\</div><div class="line">                }\</div><div class="line">              }\</div><div class="line">            ]\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "considered_execution_plans<span class="string">": [\</span></div><div class="line">              {\</div><div class="line">                "plan_prefix<span class="string">": [\</span></div><div class="line">                ],\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "best_access_path<span class="string">": {\</span></div><div class="line">                  "considered_access_paths<span class="string">": [\</span></div><div class="line">                    {\</div><div class="line">                      "access_type<span class="string">": "</span>ref<span class="string">",\</span></div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_1<span class="string">",\</span></div><div class="line">                      "<span class="keyword">rows</span><span class="string">": 2924,\</span></div><div class="line">                      "cost<span class="string">": 3508.8,\</span></div><div class="line">                      "chosen<span class="string">": true\</span></div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "access_type<span class="string">": "</span>ref<span class="string">",\</span></div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_lc<span class="string">",\</span></div><div class="line">                      "<span class="keyword">rows</span><span class="string">": 2924,\</span></div><div class="line">                      "cost<span class="string">": 3508.8,\</span></div><div class="line">                      "chosen<span class="string">": false\</span></div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "access_type<span class="string">": "</span>ref<span class="string">",\</span></div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_lc_2<span class="string">",\</span></div><div class="line">                      "<span class="keyword">rows</span><span class="string">": 2924,\</span></div><div class="line">                      "cost<span class="string">": 3508.8,\</span></div><div class="line">                      "chosen<span class="string">": false\</span></div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "access_type<span class="string">": "</span>range<span class="string">",\</span></div><div class="line">                      "cause<span class="string">": "</span>heuristic_index_cheaper<span class="string">",\</span></div><div class="line">                      "chosen<span class="string">": false\</span></div><div class="line">                    }\</div><div class="line">                  ]\</div><div class="line">                },\</div><div class="line">                "cost_for_plan<span class="string">": 3508.8,\</span></div><div class="line">                "rows_for_plan<span class="string">": 2924,\</span></div><div class="line">                "chosen<span class="string">": true\</span></div><div class="line">              }\</div><div class="line">            ]\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "attaching_conditions_to_tables<span class="string">": {\</span></div><div class="line">              "original_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagType`</span> = <span class="number">1</span>) <span class="keyword">and</span> (<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>))<span class="string">",\</span></div><div class="line">              "attached_conditions_computation<span class="string">": [\</span></div><div class="line">              ],\</div><div class="line">              "attached_conditions_summary<span class="string">": [\</span></div><div class="line">                {\</div><div class="line">                  "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                  "attached<span class="string">": "</span>(<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>)<span class="string">"\</span></div><div class="line">                }\</div><div class="line">              ]\</div><div class="line">            }\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "clause_processing<span class="string">": {\</span></div><div class="line">              "clause<span class="string">": "</span><span class="keyword">ORDER</span> <span class="keyword">BY</span><span class="string">",\</span></div><div class="line">              "original_clause<span class="string">": "</span><span class="string">`test_table`</span>.<span class="string">`TagId`</span><span class="string">",\</span></div><div class="line">              "items<span class="string">": [\</span></div><div class="line">                {\</div><div class="line">                  "item<span class="string">": "</span><span class="string">`test_table`</span>.<span class="string">`TagId`</span><span class="string">"\</span></div><div class="line">                }\</div><div class="line">              ],\</div><div class="line">              "resulting_clause_is_simple<span class="string">": true,\</span></div><div class="line">              "resulting_clause<span class="string">": "</span><span class="string">`test_table`</span>.<span class="string">`TagId`</span><span class="string">"\</span></div><div class="line">            }\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "refine_plan<span class="string">": [\</span></div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "pushed_index_condition<span class="string">": "</span>(<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>)<span class="string">",\</span></div><div class="line">                "table_condition_attached<span class="string">": null\</span></div><div class="line">              }\</div><div class="line">            ]\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "added_back_ref_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagType`</span> &lt;=&gt; <span class="number">1</span>) <span class="keyword">and</span> (<span class="string">`test_table`</span>.<span class="string">`TagName`</span> &lt;=&gt; <span class="string">'采光充足'</span>))<span class="string">"\</span></div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "reconsidering_access_paths_for_index_ordering<span class="string">": {\</span></div><div class="line">              "clause<span class="string">": "</span><span class="keyword">ORDER</span> <span class="keyword">BY</span><span class="string">",\</span></div><div class="line">              "index_order_summary<span class="string">": {\</span></div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span><span class="string">",\</span></div><div class="line">                "index_provides_order<span class="string">": true,\</span></div><div class="line">                "order_direction<span class="string">": "</span><span class="keyword">asc</span><span class="string">",\</span></div><div class="line">                "disabled_pushed_condition_on_old_index<span class="string">": true,\</span></div><div class="line">                "<span class="keyword">index</span><span class="string">": "</span><span class="keyword">PRIMARY</span><span class="string">",\</span></div><div class="line">                "plan_changed<span class="string">": true,\</span></div><div class="line">                "access_type<span class="string">": "</span>index_scan<span class="string">"\</span></div><div class="line">              }\</div><div class="line">            }\</div><div class="line">          }\</div><div class="line">        ]\</div><div class="line">      }\</div><div class="line">    },\</div><div class="line">    {\</div><div class="line">      "join_execution<span class="string">": {\</span></div><div class="line">        "<span class="keyword">select</span>#<span class="string">": 1,\</span></div><div class="line">        "steps<span class="string">": [\</span></div><div class="line">        ]\</div><div class="line">      }\</div><div class="line">    }\</div><div class="line">  ]\</div><div class="line">}</div></pre></td></tr></table></figure>

<ul>
<li><strong>正确的选择</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div></pre></td><td class="code"><pre><div class="line">{\</div><div class="line">  "steps": [\</div><div class="line">    {\</div><div class="line">      "join_preparation": {\</div><div class="line">        "<span class="operator"><span class="keyword">select</span>#<span class="string">": 1,\</span></span></div><div class="line">        "steps<span class="string">": [\</span></div><div class="line">          {\</div><div class="line">            "expanded_query<span class="string">": "</span><span class="comment">/* select#1 */</span> <span class="keyword">select</span> <span class="string">`test_table`</span>.<span class="string">`TagId`</span> <span class="keyword">AS</span> <span class="string">`TagId`</span>,<span class="string">`test_table`</span>.<span class="string">`TagType`</span> <span class="keyword">AS</span> <span class="string">`TagType`</span>,<span class="string">`test_table`</span>.<span class="string">`SubType`</span> <span class="keyword">AS</span> <span class="string">`SubType`</span>,<span class="string">`test_table`</span>.<span class="string">`CommId`</span> <span class="keyword">AS</span> <span class="string">`CommId`</span>,<span class="string">`test_table`</span>.<span class="string">`TagFlag`</span> <span class="keyword">AS</span> <span class="string">`TagFlag`</span>,<span class="string">`test_table`</span>.<span class="string">`TagName`</span> <span class="keyword">AS</span> <span class="string">`TagName`</span>,<span class="string">`test_table`</span>.<span class="string">`OrderId`</span> <span class="keyword">AS</span> <span class="string">`OrderId`</span>,<span class="string">`test_table`</span>.<span class="string">`Unum`</span> <span class="keyword">AS</span> <span class="string">`Unum`</span>,<span class="string">`test_table`</span>.<span class="string">`IsBest`</span> <span class="keyword">AS</span> <span class="string">`IsBest`</span>,<span class="string">`test_table`</span>.<span class="string">`BrokerId`</span> <span class="keyword">AS</span> <span class="string">`BrokerId`</span>,<span class="string">`test_table`</span>.<span class="string">`AddDate`</span> <span class="keyword">AS</span> <span class="string">`AddDate`</span>,<span class="string">`test_table`</span>.<span class="string">`UpdateDate`</span> <span class="keyword">AS</span> <span class="string">`UpdateDate`</span>,<span class="string">`test_table`</span>.<span class="string">`updatetime`</span> <span class="keyword">AS</span> <span class="string">`updatetime`</span>,<span class="string">`test_table`</span>.<span class="string">`tmpnum`</span> <span class="keyword">AS</span> <span class="string">`tmpnum`</span>,<span class="string">`test_table`</span>.<span class="string">`cityid`</span> <span class="keyword">AS</span> <span class="string">`cityid`</span> <span class="keyword">from</span> <span class="string">`test_table`</span> <span class="keyword">FORCE</span> <span class="keyword">INDEX</span> (<span class="string">`idx_lc`</span>) <span class="keyword">where</span> ((<span class="string">`test_table`</span>.<span class="string">`TagType`</span> = <span class="number">1</span>) <span class="keyword">and</span> (<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>)) <span class="keyword">order</span> <span class="keyword">by</span> <span class="string">`test_table`</span>.<span class="string">`TagId`</span> <span class="keyword">limit</span> <span class="number">1</span><span class="string">"\</span></div><div class="line">          }\</div><div class="line">        ]\</div><div class="line">      }\</div><div class="line">    },\</div><div class="line">    {\</div><div class="line">      "join_optimization<span class="string">": {\</span></div><div class="line">        "<span class="keyword">select</span>#<span class="string">": 1,\</span></div><div class="line">        "steps<span class="string">": [\</span></div><div class="line">          {\</div><div class="line">            "condition_processing<span class="string">": {\</span></div><div class="line">              "condition<span class="string">": "</span><span class="keyword">WHERE</span><span class="string">",\</span></div><div class="line">              "original_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagType`</span> = <span class="number">1</span>) <span class="keyword">and</span> (<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>))<span class="string">",\</span></div><div class="line">              "steps<span class="string">": [\</span></div><div class="line">                {\</div><div class="line">                  "transformation<span class="string">": "</span>equality_propagation<span class="string">",\</span></div><div class="line">                  "resulting_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>) <span class="keyword">and</span> multiple equal(<span class="number">1</span>, <span class="string">`test_table`</span>.<span class="string">`TagType`</span>))<span class="string">"\</span></div><div class="line">                },\</div><div class="line">                {\</div><div class="line">                  "transformation<span class="string">": "</span>constant_propagation<span class="string">",\</span></div><div class="line">                  "resulting_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>) <span class="keyword">and</span> multiple equal(<span class="number">1</span>, <span class="string">`test_table`</span>.<span class="string">`TagType`</span>))<span class="string">"\</span></div><div class="line">                },\</div><div class="line">                {\</div><div class="line">                  "transformation<span class="string">": "</span>trivial_condition_removal<span class="string">",\</span></div><div class="line">                  "resulting_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>) <span class="keyword">and</span> multiple equal(<span class="number">1</span>, <span class="string">`test_table`</span>.<span class="string">`TagType`</span>))<span class="string">"\</span></div><div class="line">                }\</div><div class="line">              ]\</div><div class="line">            }\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "table_dependencies<span class="string">": [\</span></div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span> <span class="keyword">FORCE</span> <span class="keyword">INDEX</span> (<span class="string">`idx_lc`</span>)<span class="string">",\</span></div><div class="line">                "row_may_be_null<span class="string">": false,\</span></div><div class="line">                "map_bit<span class="string">": 0,\</span></div><div class="line">                "depends_on_map_bits<span class="string">": [\</span></div><div class="line">                ]\</div><div class="line">              }\</div><div class="line">            ]\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "ref_optimizer_key_uses<span class="string">": [\</span></div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span> <span class="keyword">FORCE</span> <span class="keyword">INDEX</span> (<span class="string">`idx_lc`</span>)<span class="string">",\</span></div><div class="line">                "<span class="keyword">field</span><span class="string">": "</span>TagType<span class="string">",\</span></div><div class="line">                "equals<span class="string">": "</span><span class="number">1</span><span class="string">",\</span></div><div class="line">                "null_rejecting<span class="string">": false\</span></div><div class="line">              },\</div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span> <span class="keyword">FORCE</span> <span class="keyword">INDEX</span> (<span class="string">`idx_lc`</span>)<span class="string">",\</span></div><div class="line">                "<span class="keyword">field</span><span class="string">": "</span>TagName<span class="string">",\</span></div><div class="line">                "equals<span class="string">": "</span><span class="string">'采光充足'</span><span class="string">",\</span></div><div class="line">                "null_rejecting<span class="string">": false\</span></div><div class="line">              }\</div><div class="line">            ]\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "rows_estimation<span class="string">": [\</span></div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span> <span class="keyword">FORCE</span> <span class="keyword">INDEX</span> (<span class="string">`idx_lc`</span>)<span class="string">",\</span></div><div class="line">                "range_analysis<span class="string">": {\</span></div><div class="line">                  "table_scan<span class="string">": {\</span></div><div class="line">                    "<span class="keyword">rows</span><span class="string">": 1131547,\</span></div><div class="line">                    "cost<span class="string">": 2e308\</span></div><div class="line">                  },\</div><div class="line">                  "potential_range_indices<span class="string">": [\</span></div><div class="line">                    {\</div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span><span class="keyword">PRIMARY</span><span class="string">",\</span></div><div class="line">                      "usable<span class="string">": false,\</span></div><div class="line">                      "cause<span class="string">": "</span>not_applicable<span class="string">"\</span></div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_4<span class="string">",\</span></div><div class="line">                      "usable<span class="string">": false,\</span></div><div class="line">                      "cause<span class="string">": "</span>not_applicable<span class="string">"\</span></div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idxnew<span class="string">",\</span></div><div class="line">                      "usable<span class="string">": false,\</span></div><div class="line">                      "cause<span class="string">": "</span>not_applicable<span class="string">"\</span></div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_lc<span class="string">",\</span></div><div class="line">                      "usable<span class="string">": true,\</span></div><div class="line">                      "key_parts<span class="string">": [\</span></div><div class="line">                        "TagType<span class="string">",\</span></div><div class="line">                        "TagName<span class="string">",\</span></div><div class="line">                        "TagId<span class="string">"\</span></div><div class="line">                      ]\</div><div class="line">                    }\</div><div class="line">                  ],\</div><div class="line">                  "setup_range_conditions<span class="string">": [\</span></div><div class="line">                  ],\</div><div class="line">                  "group_index_range<span class="string">": {\</span></div><div class="line">                    "chosen<span class="string">": false,\</span></div><div class="line">                    "cause<span class="string">": "</span>not_group_by_or_distinct<span class="string">"\</span></div><div class="line">                  },\</div><div class="line">                  "analyzing_range_alternatives<span class="string">": {\</span></div><div class="line">                    "range_scan_alternatives<span class="string">": [\</span></div><div class="line">                      {\</div><div class="line">                        "<span class="keyword">index</span><span class="string">": "</span>idx_lc<span class="string">",\</span></div><div class="line">                        "ranges<span class="string">": [\</span></div><div class="line">                          "<span class="number">1</span> &lt;= TagType &lt;= <span class="number">1</span> <span class="keyword">AND</span> 采光充足 &lt;= TagName &lt;= 采光充足<span class="string">"\</span></div><div class="line">                        ],\</div><div class="line">                        "index_dives_for_eq_ranges<span class="string">": true,\</span></div><div class="line">                        "rowid_ordered<span class="string">": true,\</span></div><div class="line">                        "using_mrr<span class="string">": false,\</span></div><div class="line">                        "index_only<span class="string">": false,\</span></div><div class="line">                        "<span class="keyword">rows</span><span class="string">": 2931,\</span></div><div class="line">                        "cost<span class="string">": 3518.2,\</span></div><div class="line">                        "chosen<span class="string">": true\</span></div><div class="line">                      }\</div><div class="line">                    ],\</div><div class="line">                    "analyzing_roworder_intersect<span class="string">": {\</span></div><div class="line">                      "usable<span class="string">": false,\</span></div><div class="line">                      "cause<span class="string">": "</span>too_few_roworder_scans<span class="string">"\</span></div><div class="line">                    }\</div><div class="line">                  },\</div><div class="line">                  "chosen_range_access_summary<span class="string">": {\</span></div><div class="line">                    "range_access_plan<span class="string">": {\</span></div><div class="line">                      "type<span class="string">": "</span>range_scan<span class="string">",\</span></div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_lc<span class="string">",\</span></div><div class="line">                      "<span class="keyword">rows</span><span class="string">": 2931,\</span></div><div class="line">                      "ranges<span class="string">": [\</span></div><div class="line">                        "<span class="number">1</span> &lt;= TagType &lt;= <span class="number">1</span> <span class="keyword">AND</span> 采光充足 &lt;= TagName &lt;= 采光充足<span class="string">"\</span></div><div class="line">                      ]\</div><div class="line">                    },\</div><div class="line">                    "rows_for_plan<span class="string">": 2931,\</span></div><div class="line">                    "cost_for_plan<span class="string">": 3518.2,\</span></div><div class="line">                    "chosen<span class="string">": true\</span></div><div class="line">                  }\</div><div class="line">                }\</div><div class="line">              }\</div><div class="line">            ]\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "considered_execution_plans<span class="string">": [\</span></div><div class="line">              {\</div><div class="line">                "plan_prefix<span class="string">": [\</span></div><div class="line">                ],\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span> <span class="keyword">FORCE</span> <span class="keyword">INDEX</span> (<span class="string">`idx_lc`</span>)<span class="string">",\</span></div><div class="line">                "best_access_path<span class="string">": {\</span></div><div class="line">                  "considered_access_paths<span class="string">": [\</span></div><div class="line">                    {\</div><div class="line">                      "access_type<span class="string">": "</span>ref<span class="string">",\</span></div><div class="line">                      "<span class="keyword">index</span><span class="string">": "</span>idx_lc<span class="string">",\</span></div><div class="line">                      "<span class="keyword">rows</span><span class="string">": 2931,\</span></div><div class="line">                      "cost<span class="string">": 3517.2,\</span></div><div class="line">                      "chosen<span class="string">": true\</span></div><div class="line">                    },\</div><div class="line">                    {\</div><div class="line">                      "access_type<span class="string">": "</span>range<span class="string">",\</span></div><div class="line">                      "cause<span class="string">": "</span>heuristic_index_cheaper<span class="string">",\</span></div><div class="line">                      "chosen<span class="string">": false\</span></div><div class="line">                    }\</div><div class="line">                  ]\</div><div class="line">                },\</div><div class="line">                "cost_for_plan<span class="string">": 3517.2,\</span></div><div class="line">                "rows_for_plan<span class="string">": 2931,\</span></div><div class="line">                "chosen<span class="string">": true\</span></div><div class="line">              }\</div><div class="line">            ]\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "attaching_conditions_to_tables<span class="string">": {\</span></div><div class="line">              "original_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagType`</span> = <span class="number">1</span>) <span class="keyword">and</span> (<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>))<span class="string">",\</span></div><div class="line">              "attached_conditions_computation<span class="string">": [\</span></div><div class="line">              ],\</div><div class="line">              "attached_conditions_summary<span class="string">": [\</span></div><div class="line">                {\</div><div class="line">                  "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span> <span class="keyword">FORCE</span> <span class="keyword">INDEX</span> (<span class="string">`idx_lc`</span>)<span class="string">",\</span></div><div class="line">                  "attached<span class="string">": "</span>(<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>)<span class="string">"\</span></div><div class="line">                }\</div><div class="line">              ]\</div><div class="line">            }\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "clause_processing<span class="string">": {\</span></div><div class="line">              "clause<span class="string">": "</span><span class="keyword">ORDER</span> <span class="keyword">BY</span><span class="string">",\</span></div><div class="line">              "original_clause<span class="string">": "</span><span class="string">`test_table`</span>.<span class="string">`TagId`</span><span class="string">",\</span></div><div class="line">              "items<span class="string">": [\</span></div><div class="line">                {\</div><div class="line">                  "item<span class="string">": "</span><span class="string">`test_table`</span>.<span class="string">`TagId`</span><span class="string">"\</span></div><div class="line">                }\</div><div class="line">              ],\</div><div class="line">              "resulting_clause_is_simple<span class="string">": true,\</span></div><div class="line">              "resulting_clause<span class="string">": "</span><span class="string">`test_table`</span>.<span class="string">`TagId`</span><span class="string">"\</span></div><div class="line">            }\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "refine_plan<span class="string">": [\</span></div><div class="line">              {\</div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span> <span class="keyword">FORCE</span> <span class="keyword">INDEX</span> (<span class="string">`idx_lc`</span>)<span class="string">",\</span></div><div class="line">                "pushed_index_condition<span class="string">": "</span>(<span class="string">`test_table`</span>.<span class="string">`TagName`</span> = <span class="string">'采光充足'</span>)<span class="string">",\</span></div><div class="line">                "table_condition_attached<span class="string">": null\</span></div><div class="line">              }\</div><div class="line">            ]\</div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "added_back_ref_condition<span class="string">": "</span>((<span class="string">`test_table`</span>.<span class="string">`TagType`</span> &lt;=&gt; <span class="number">1</span>) <span class="keyword">and</span> (<span class="string">`test_table`</span>.<span class="string">`TagName`</span> &lt;=&gt; <span class="string">'采光充足'</span>))<span class="string">"\</span></div><div class="line">          },\</div><div class="line">          {\</div><div class="line">            "reconsidering_access_paths_for_index_ordering<span class="string">": {\</span></div><div class="line">              "clause<span class="string">": "</span><span class="keyword">ORDER</span> <span class="keyword">BY</span><span class="string">",\</span></div><div class="line">              "index_order_summary<span class="string">": {\</span></div><div class="line">                "<span class="keyword">table</span><span class="string">": "</span><span class="string">`test_table`</span> <span class="keyword">FORCE</span> <span class="keyword">INDEX</span> (<span class="string">`idx_lc`</span>)<span class="string">",\</span></div><div class="line">                "index_provides_order<span class="string">": true,\</span></div><div class="line">                "order_direction<span class="string">": "</span><span class="keyword">asc</span><span class="string">",\</span></div><div class="line">                "<span class="keyword">index</span><span class="string">": "</span>idx_lc<span class="string">",\</span></div><div class="line">                "plan_changed<span class="string">": false\</span></div><div class="line">              }\</div><div class="line">            }\</div><div class="line">          }\</div><div class="line">        ]\</div><div class="line">      }\</div><div class="line">    },\</div><div class="line">    {\</div><div class="line">      "join_execution<span class="string">": {\</span></div><div class="line">        "<span class="keyword">select</span>#<span class="string">": 1,\</span></div><div class="line">        "steps<span class="string">": [\</span></div><div class="line">        ]\</div><div class="line">      }\</div><div class="line">    }\</div><div class="line">  ]\</div><div class="line">}</div></pre></td></tr></table></figure>

  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/SQL-Tuning/">SQL Tuning</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/MySQL/">MySQL</a>
</div>



<div class="article-share" id="share">

  <div data-url="https://Keithlan.github.io/2016/03/14/wrong_index/" data-title="SQL优化：执行计划出错之重复索引干扰 | Focus on MySQL,Focus on Life" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/04/06/auto_incre_reduce/" title="auto_increment的后裔">
  <strong>PREVIOUS:</strong><br/>
  <span>
  auto_increment的后裔</span>
</a>
</div>


<div class="next">
<a href="/2015/12/06/innodb_semaphore/"  title="InnoDB hung&amp;crash : a long semaphore wait">
 <strong>NEXT:</strong><br/> 
 <span>InnoDB hung&amp;crash : a long semaphore wait
</span>
</a>
</div>

</nav>

	

<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="/2016/03/14/wrong_index/" data-title="SQL优化：执行计划出错之重复索引干扰" data-url="https://Keithlan.github.io/2016/03/14/wrong_index/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:keithlan};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->


</div>  
      
  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#本篇为执行计划错误系列第二篇，第一篇地址"><span class="toc-number">1.</span> <span class="toc-text">本篇为执行计划错误系列第二篇，第一篇地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#背景"><span class="toc-number">2.</span> <span class="toc-text">背景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL版本"><span class="toc-number">2.1.</span> <span class="toc-text">MySQL版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表结构"><span class="toc-number">2.2.</span> <span class="toc-text">表结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#index_选择性"><span class="toc-number">2.3.</span> <span class="toc-text">index 选择性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题SQL"><span class="toc-number">2.4.</span> <span class="toc-text">问题SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题再哪里？"><span class="toc-number">2.5.</span> <span class="toc-text">问题再哪里？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#继续分析"><span class="toc-number">2.6.</span> <span class="toc-text">继续分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#最后的优化建议："><span class="toc-number">2.7.</span> <span class="toc-text">最后的优化建议：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#疑问"><span class="toc-number">2.8.</span> <span class="toc-text">疑问</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最后总结"><span class="toc-number">3.</span> <span class="toc-text">最后总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#详细的执行代价评估"><span class="toc-number">4.</span> <span class="toc-text">详细的执行代价评估</span></a></li></ol>
  </div>

<div id="asidepart">
<div id="authorInfo">
	
		<div class="author-logo"></div>		
	
	
	<section class="author-info">
		
			<p> 幸福,不在于得到的多</p>
		
		
			<p>	而在于计较的少</p>
		
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2101743962" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/Keithlan" target="_blank" title="github"></a>
		
		
	</div>
</div>
<aside class="clearfix">


  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
			<li><a href="/categories/MySQL/" title="MySQL">MySQL<sup>49</sup></a></li>
		
			<li><a href="/categories/personal/" title="personal">personal<sup>1</sup></a></li>
		
			<li><a href="/categories/分享/" title="分享">分享<sup>37</sup></a></li>
		
		</ul>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">Archives</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">1</span></li></ul>
  </div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Error/" title="Error">Error<sup>2</sup></a></li>
		
			<li><a href="/tags/InnoDB-Lock/" title="InnoDB Lock">InnoDB Lock<sup>9</sup></a></li>
		
			<li><a href="/tags/Life-share/" title="Life share">Life share<sup>1</sup></a></li>
		
			<li><a href="/tags/Linux-share/" title="Linux share">Linux share<sup>1</sup></a></li>
		
			<li><a href="/tags/MHA/" title="MHA">MHA<sup>2</sup></a></li>
		
			<li><a href="/tags/MySQL-Error/" title="MySQL Error">MySQL Error<sup>12</sup></a></li>
		
			<li><a href="/tags/MySQL-SYS-toolkit/" title="MySQL SYS toolkit">MySQL SYS toolkit<sup>2</sup></a></li>
		
			<li><a href="/tags/MySQL-feature/" title="MySQL feature">MySQL feature<sup>4</sup></a></li>
		
			<li><a href="/tags/MySQL-share/" title="MySQL share">MySQL share<sup>46</sup></a></li>
		
			<li><a href="/tags/MySQL-tools/" title="MySQL tools">MySQL tools<sup>5</sup></a></li>
		
			<li><a href="/tags/MySQL-实战/" title="MySQL 实战">MySQL 实战<sup>1</sup></a></li>
		
			<li><a href="/tags/SQL-Tuning/" title="SQL Tuning">SQL Tuning<sup>1</sup></a></li>
		
			<li><a href="/tags/sysbench/" title="sysbench">sysbench<sup>1</sup></a></li>
		
		</ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >

</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  //back to top
  function backToTop(){
    var buttonHTML = $("<a href=\"#top\" id=\"back-top\">" + "<span>Back to Top</span></a>");
    buttonHTML.appendTo($("body"));
    var buttonToTop = $("#back-top");
    // hide #back-top first
    buttonToTop.hide();

    // fade in #back-top
    $(function() {
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                buttonToTop.fadeIn();
            } else {
                buttonToTop.fadeOut();
            }
        });
        // scroll body to 0px on click
        buttonToTop.click(function() {
            $('body,html').animate({
                scrollTop: 0
            }, 800);
            return false;
        });
    });
  }
  backToTop();

  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      ta = $('#toc.toc-aside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });

  var show = true;
  c.click(function(){
    if(show == true){
        a.addClass('fadeOut').css('display', 'none');
        ta.css('display', 'block').addClass('fadeIn');
        m.addClass('moveMain');  
    }else{
        a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');     
        ta.css('display', 'none'); 
        m.removeClass('moveMain');
        $('#toc.toc-aside').css('display', 'none');
    }
    show = !show;
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{

    $(window).scroll(function(){
      ta.css("top",Math.max(140,240-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"keithlan"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
